
<script type="text/x-red" data-template-name="ezlo-item">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub">Hub</span></label>
        <input type="text" id="node-input-hub">
    </div>
    <div class="form-row">
        <label for="node-input-itemId"><i class="fa fa-tag"></i> Item ID</label>
        <input type="text" id="node-input-itemId" placeholder="The item ID">
    </div>
    <div class="form-row">
        <label for="node-input-description"><i class="fa fa-comment"></i> Description</label>
        <input type="text" id="node-input-description" placeholder="The description of the item (optional)">
    </div>
    <div class="form-row">
        <label style="width: auto;" for="node-input-responseType"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic">Output Format</span></label>
        <select id="node-input-responseType" style="width: auto">
            <option value="" data-i18n="ezlo.response.simple">Simple (value only)</option>
            <option value="abbr" data-i18n="ezlo.response.abbrev">Abbreviated (id, name, value)</option>
            <option value="full" data-i18n="ezlo.response.full">Full</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-help-name="ezlo-item">
    <p>Interface to an item, which is a value attached to a device. On Ezlo hubs, you manipulate devices by setting
    values. For example, rather than sending a "set level" action to a dimmer to change its brightness, you set the
    value of the dimmer device's <tt>dimmer</tt> item. So this node has one input and one output. State changes for the
    item appear on the output. Requests to modify the value are sent to the input.

    <h3>Configuration</h3>
    <p>itemID is the ID of the item. Each items has a unique ID.</p>
    <p>Description of the item; this is really just for your notes to help you remember what it is.</p>

    <h3>Inputs</h3>
    <p>Status request: empty payload</p>
    <p>Set Item Value</p>
    <p><code>msg.payload</code></p>
    <ul>
        <code>value</code> - a number, string (unquoted), boolean (`true` or `false`), or object/array that matches the expected type of the item (per the Ezlo API).
    </ul>

    <h3>Outputs</h3>
    <p>Item Value</p>
    <p><code>msg.payload</code></p>
    <ul>
        <code>value</code> - the current/new value of the item (type according to the Ezlo API).
    </ul>
</script>

<script type="text/x-red" data-template-name="ezlo-device">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub">Hub</span></label>
        <input type="text" id="node-input-hub">
    </div>
    <div class="form-row">
        <label for="node-input-deviceId"><i class="fa fa-tag"></i> Device ID</label>
        <input type="text" id="node-input-deviceId" placeholder="The Device ID">
    </div>
    <div class="form-row">
        <label for="node-input-description"><i class="fa fa-comment"></i> Description</label>
        <input type="text" id="node-input-description" placeholder="The description of the device (optional)">
    </div>
</script>

<script type="text/x-red" data-help-name="ezlo-device">
	<p>TBD</p>
</script>

<script type="text/x-red" data-template-name="ezlo-housemode">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub">Hub</span></label>
        <input type="text" id="node-input-hub">
    </div>
</script>

<script type="text/x-red" data-help-name="ezlo-housemode">
    <p>Interface to an item, which is a value attached to a device. On Ezlo hubs, you manipulate devices by setting
    values. For example, rather than sending a "set level" action to a dimmer to change its brightness, you set the
    value of the dimmer device's <tt>dimmer</tt> item. So this node has one input and one output. State changes for the
    item appear on the output. Requests to modify the value are sent to the input.

    <h3>Configuration</h3>
    <p>TBD </p>
    <p>Description of the item; this is really just for your notes to help you remember what it is.</p>

    <h3>Inputs</h3>
    <p>Status request: empty payload</p>
    <p>Set House Mode</p>
    <p><code>msg.payload</code></p>
    <ul>
        <code>mode</code> - a number 1-4 or one of the strings "Home", "Away", "Night" or "Vacation"
    </ul>

    <h3>Outputs</h3>
    <p>Housemode Status</p>
    <p><code>msg.payload</code></p>
    <ul>
        <code>current_id</code> - ID of the current house mode (1-4)
        <code>current_name</code> - name of the current house mode
        <code>pending_id</code> - ID of the next house mode if change is pending, *null* otherwise
        <code>pending_name</code> - name of the next house mode if change is pending, "" (empty string) otherwise
    </ul>
</script>

<script type="text/x-red" data-template-name="ezlo-hubui">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub">Hub</span></label>
        <input type="text" id="node-input-hub">
    </div>
</script>

<script type="text/x-red" data-help-name="ezlo-hubui">
    <p>Interface to Ezlo hub. Allows you to detect online/offline state of hub, and send any API action to the hub via
	its input.</p>

    <h3>Configuration</h3>
    <p>Hub</p>

    <h3>Inputs</h3>
    <p>Status request: empty payload</p>
    <p>Payload with key <code>method</code> defined will execute the named method. Parameters may be given in
	(optional) sub-object <code>params</code>. You may also set <code>api</code> if a specific API version
	response is needed. Refer to the Ezlo API documentation for details.</p>

    <h3>Outputs</h3>
    <p>Hub Status</p>
    <p><code>msg.payload</code></p>
    <ul>
		<code>online</code> or <code>offline</code> - (string) the state of the connection to the hub.
    </ul>
</script>

<script type="text/html" data-template-name="ezlo-hub">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-user-tag"></i> <span data-i18n="common.label.name">Name</span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <ul style="min-width: 600px; margin-bottom: 20px;" id="node-config-ezlo-hub-tabs"></ul>
    </div>
    <div id="node-config-ezlo-hub-tabs-content" style="min-height: 150px;">
        <div id="ezlo-hub-tab-connection" style="display: none">
            <div class="form-row node-input-serialNumber">
                <label for="node-config-input-serialNumber"><i class="fa fa-fingerprint"></i> <span data-i18n="ezlo.label.serialNumber">Serial Number</span></label>
                <input type="text" id="node-config-input-serialNumber" style="width: auto" data-i18n="[placeholder]ezlo.label.example">
            </div>
            <div class="form-row" style="margin-bottom:0">
                <input type="checkbox" id="node-config-input-autoConnect" style="margin: 0 5px 0 104px; display: inline-block; width: auto;">
                <label for="node-config-input-autoConnect" style="width: auto"><span data-i18n="ezlo.label.auto-connect">Auto-connect</span></label>
            </div>
            <div class="form-row">
                <label for="node-config-input-localIP"><i class="fa fa-network-wired"></i> <span data-i18n="ezlo.label.localIP">Local IP Address</span></label>
                <input type="text" id="node-config-input-localIP" style="width: auto;" data-i18n="[placeholder]ezlo.label.example">
            </div>
        </div>
        <div id="ezlo-hub-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-username"><i class="fa fa-user"></i> <span data-i18n="common.label.username">Username</span></label>
                <input type="text" id="node-config-input-username">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password">Password</span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="ezlo-hub-tab-options" style="display:none">
            <div class="form-row">
                <label style="width: auto;" for="node-config-input-accessAnonymous"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic">Offline Anonymous Access</span></label>
                <select id="node-config-input-accessAnonymous" style="width: auto">
                    <option value="" data-i18n="ezlo.anonUnchanged">Leave current setting</option>
                    <option value="false" data-i18n="ezlo.anonEnable">Disable anonymous access</option>
                    <option value="true" data-i18n="ezlo.anonDisable">Enable anonymous access</option>
                </select>
            </div>
        </div>
    </div>
</script>

<script type="text/x-red" data-help-name="ezlo-hub">
    <p>Interface node for an Ezlo Hub.</p>

    <h3>Configuration</h3>
    <p>Serial Number is the serial number of the Ezlo Hub, and is required for access.</p>
    <p>Username and Password are required to obtain access tokens from the Ezlo cloud.</p>
    <p>Local IP Address is optional; when given, the local hub API will be used rather than the cloud relay (still requires an access token from the Ezlo cloud).</p>

    <h3>Inputs</h3>
    <p>An empty payload outputs the hub status.</p>
    <p>The following payload will issue any method (API call) to the hub. The <tt>params</tt> object contain the key/value pairs of parameter data required by the method:
    <p><code>msg.payload</code></p>
    <ul>
        <code>{</code>
        <br/>
        <code>    method: "api-method-name", </code>
        <br/>
        <code>    params: {</code>
        <br/>
        <code>        key: value</code>
        <br/>
        <code>    }{</code>
        <br/>
        <code>}</code>
    </ul>

    <h3>Outputs</h3>
    <p>Status Report</p>
    <p><code>msg.payload</code></p>
    <ul>
        <code>offline</code> or <code>online</code>
    </ul>
</script>


<!-- ------------------------------------------------------------------------------------------ -->

<script type="text/javascript">
/* jshint esversion:8,browser:true */
/* global RED,$ */
(function() {

    RED.nodes.registerType('ezlo-hub',{
        category: 'config',
        defaults: {
            name: { value: "", required: false },
            serialNumber: { value:"", required: true },
            localIP: { value: "", required:false, validate:RED.validators.number(true)},
            autoConnect: { value: true },
            accessAnonymous: { value: "" },
        },
        credentials: {
            username: { type: "text" },
            password: { type: "password" }
        },
        label: function() {
            if ( "" !== ( this.name || "" ) ) {
                return this.name;
            }
            return this.serialNumber;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-ezlo-hub-tabs",
                onchange: function(tab) {
                    $("#node-config-ezlo-hub-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "ezlo-hub-tab-connection",
                label: this._("ezlo.tabs-label.connection") || "Connection"
            });
            tabs.addTab({
                id: "ezlo-hub-tab-security",
                label: this._("ezlo.tabs-label.security") || "Security"
            });

            tabs.addTab({
                id: "ezlo-hub-tab-options",
                label: this._("ezlo.tabs-label.options") || "Options"
            });

            setTimeout(function() { tabs.resize(); },0);

            if ( "undefined" === typeof this.accessAnonymous ) {
                this.accessAnonymous = null;
                $("#node-config-input-hub-accessAnonymous").val( "" );
            }
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo-item',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true},
            itemId: { value: "", required: true },
            description: { value: "", required: false },
            responseType: { value: "", required: false }
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-item.svg",
        label: function() {
            return this.name || this.itemId || "Item";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo-device',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true},
            deviceId: { value: "", required: true },
            description: { value: "", required: false }
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-device.svg",
        label: function() {
            return this.name || this.deviceId || "Device";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo-housemode',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true}
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-housemode.svg",
        label: function() {
            return "House Mode";
        },
        labelStyle: function() {
            return "node_label_italic";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo-hubui',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true}
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-hub.svg",
        label: function() {
            return this.name || "hub";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });
})();
</script>
