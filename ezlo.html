
<script type="text/x-red" data-template-name="ezlo item">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub">Hub</span></label>
        <input type="text" id="node-input-hub">
    </div>
    <div class="form-row">
        <label for="node-input-itemId"><i class="fa fa-tag"></i> <span data-i18n="ezlo.label.itemid"></span></label>
        <input type="text" id="node-input-itemId" data-i18n="[placeholder]ezlo.placeholder.itemid">
    </div>
    <div class="form-row">
        <label for="node-input-description"><i class="fa fa-comment"></i> <span data-i18n="ezlo.label.description"></span></label>
        <input type="text" id="node-input-description" data-i18n="[placeholder]ezlo.placeholder.itemdescription">
    </div>
    <div class="form-row">
        <label style="width: auto;" for="node-input-responseType"><i class="fa fa-tasks"></i> <span data-i18n="ezlo.label.outputformat"></span></label>
        <select id="node-input-responseType" style="width: auto">
            <option value="" data-i18n="ezlo.item-response.simple"></option>
            <option value="abbr" data-i18n="ezlo.item-response.abbr"></option>
            <option value="full" data-i18n="ezlo.item-response.full"></option>
        </select>
    </div>
</script>

<script type="text/x-red" data-template-name="ezlo device">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub"></span></label>
        <input type="text" id="node-input-hub">
    </div>
    <div class="form-row">
        <label for="node-input-deviceId"><i class="fa fa-tag"></i> <span data-i18n="ezlo.label.deviceid"></span></label>
        <input type="text" id="node-input-deviceId" data-i18n="[placeholder]ezlo.placeholder.deviceid">
    </div>
    <div class="form-row">
        <label for="node-input-description"><i class="fa fa-comment"></i> <span data-i18n="ezlo.label.description"></span></label>
        <input type="text" id="node-input-description" data-i18n="[placeholder]ezlo.placeholder.devicedescription">
    </div>
</script>

<script type="text/x-red" data-template-name="ezlo house mode">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub"></span></label>
        <input type="text" id="node-input-hub">
    </div>
    <div class="form-row">
        <label style="width: auto;" for="node-input-responseType"><i class="fa fa-tasks"></i> <span data-i18n="ezlo.label.outputformat"></span></label>
        <select id="node-input-responseType" style="width: auto">
            <option value="" data-i18n="ezlo.housemode-response.name"></option>
            <option value="id" data-i18n="ezlo.housemode-response.id"></option>
            <option value="curr" data-i18n="ezlo.housemode-response.curr"></option>
            <option value="full" data-i18n="ezlo.housemode-response.full"></option>
        </select>
    </div>
</script>

<script type="text/x-red" data-template-name="ezlo hub info">
    <div class="form-row">
        <label for="node-input-hub"><i class="fa fa-globe"></i> <span data-i18n="ezlo.label.hub"></span></label>
        <input type="text" id="node-input-hub">
    </div>
</script>

<script type="text/html" data-template-name="ezlo-hub">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-user-tag"></i> <span data-i18n="ezlo.label.name"></span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]ezlo.placeholder.name">
    </div>
    <div class="form-row">
        <ul style="min-width: 600px; margin-bottom: 20px;" id="node-config-ezlo-hub-tabs"></ul>
    </div>
    <div id="node-config-ezlo-hub-tabs-content" style="min-height: 150px;">
        <div id="ezlo-hub-tab-connection" style="display: none">
            <div class="form-row node-input-serialNumber">
                <label for="node-config-input-serialNumber"><i class="fa fa-fingerprint"></i> <span data-i18n="ezlo.label.serialNumber"></span></label>
                <input type="text" id="node-config-input-serialNumber" style="width: auto" data-i18n="[placeholder]ezlo.label.serialExample">
            </div>
            <div class="form-row" style="margin-bottom:0">
                <input type="checkbox" id="node-config-input-autoConnect" style="margin: 0 5px 0 104px; display: inline-block; width: auto;">
                <label for="node-config-input-autoConnect" style="width: auto"><span data-i18n="ezlo.label.autoConnect"</span></label>
            </div>
            <div class="form-row">
                <label for="node-config-input-localIP"><i class="fa fa-network-wired"></i> <span data-i18n="ezlo.label.localIP"></span></label>
                <input type="text" id="node-config-input-localIP" style="width: auto;" data-i18n="[placeholder]ezlo.label.ipExample">
            </div>
        </div>
        <div id="ezlo-hub-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-username"><i class="fa fa-user"></i> <span data-i18n="ezlo.label.username"></span></label>
                <input type="text" id="node-config-input-username">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="ezlo.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="ezlo-hub-tab-options" style="display:none">
            <div class="form-row">
                <label style="width: auto;" for="node-config-input-accessAnonymous"><i class="fa fa-tasks"></i> <span data-i18n="ezlo.label.accessAnonymous"></span></label>
                <select id="node-config-input-accessAnonymous" style="width: auto">
                    <option value="" data-i18n="ezlo.options.anonUnchanged"></option>
                    <option value="false" data-i18n="ezlo.options.anonEnable"></option>
                    <option value="true" data-i18n="ezlo.options.anonDisable"></option>
                </select>
            </div>
            <div class="form-row" style="margin-bottom:0">
                <input type="checkbox" id="node-config-input-debug" style="margin: 0 5px 0 104px; display: inline-block; width: auto;">
                <label for="node-config-input-debug" style="width: auto"><span data-i18n="ezlo.label.debug"></span></label>
            </div>
        </div>
    </div>
</script>

<!-- ------------------------------------------------------------------------------------------ -->

<script type="text/javascript">
/* jshint esversion:8,browser:true */
/* global RED,$ */
(function() {

    RED.nodes.registerType('ezlo-hub',{
        category: 'config',
        defaults: {
            name: { value: "", required: false },
            serialNumber: { value:"", required: true },
            localIP: { value: "", required:false, validate:RED.validators.number(true)},
            autoConnect: { value: true },
            accessAnonymous: { value: "" },
            debug: { value: false, required: false }
        },
        credentials: {
            username: { type: "text" },
            password: { type: "password" }
        },
        label: function() {
            if ( "" !== ( this.name || "" ) ) {
                return this.name;
            }
            return this.serialNumber;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-ezlo-hub-tabs",
                onchange: function(tab) {
                    $("#node-config-ezlo-hub-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "ezlo-hub-tab-connection",
                label: this._("ezlo.tabs-label.connection") || "Connection"
            });
            tabs.addTab({
                id: "ezlo-hub-tab-security",
                label: this._("ezlo.tabs-label.security") || "Security"
            });

            tabs.addTab({
                id: "ezlo-hub-tab-options",
                label: this._("ezlo.tabs-label.options") || "Options"
            });

            setTimeout(function() { tabs.resize(); },0);

            if ( "undefined" === typeof this.accessAnonymous ) {
                this.accessAnonymous = null;
                $("#node-config-input-accessAnonymous").val( "" );
            }
            if ( "undefined" === typeof this.debug ) {
                this.debug = false;
                $('#node-config-input-debug').prop( 'checked', false );
            }
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo item',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true},
            itemId: { value: "", required: true },
            description: { value: "", required: false },
            responseType: { value: "", required: false }
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-item.svg",
        label: function() {
            return this.description || this.itemId || "ezlo item";
        },
        labelStyle: function() {
            return this.description?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo device',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true},
            deviceId: { value: "", required: true },
            description: { value: "", required: false }
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-device.svg",
        label: function() {
            return this.description || this.deviceId || "ezlo device";
        },
        labelStyle: function() {
            return this.description?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo house mode',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true },
            responseType: { value: "", required: false }
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-housemode.svg",
        label: function() {
            //console.log("in house mode label func, this is",this);
            return "House Mode";
        },
        labelStyle: function() {
            return "node_label_italic";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
            if ( "undefined" === typeof this.responseType ) {
                this.responseType = "";
                $("#node-input-responseType").val( "" );
            }
        },
        oneditsave: function() {
        }
    });

    RED.nodes.registerType('ezlo hub info',{
        category: 'ezlo',
        defaults: {
            hub: { type:"ezlo-hub", required: true}
        },
        color:"#d8bfd8",
        inputs: 1,
        outputs: 1,
        icon: "ezlo-hub.svg",
        label: function() {
            return this.name || "ezlo hub";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            $("#node-input-hub").on( "change", function(d) {
            });
        },
        oneditsave: function() {
        }
    });
})();
</script>
